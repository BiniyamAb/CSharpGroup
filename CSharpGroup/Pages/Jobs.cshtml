@page
@model CSharpGroup.Pages.JobsModel
@{
}


<br>

<div class="container">
    <ul class="nav nav-pills nav-pills nav-justified mb-3" id="pills-tab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="pills-jobs-tab" data-toggle="pill" href="#pills-jobs" role="tab" aria-controls="pills-jobs" aria-selected="false">Jobs</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="pills-history-tab" data-toggle="pill" href="#pills-history" role="tab" aria-controls="pills-history" aria-selected="true">History</a>
        </li>
    </ul>
    <div class="tab-content" id="pills-tabContent">
        <div class="tab-pane fade show active" id="pills-jobs" role="tabpanel" aria-labelledby="pills-jobs-tab">
            <div class="container">

                @if (Model._orderList != null)
                {
                    <table class="table">
                        <thead class="thead-dark">
                            <tr>
                                <th scope="col">Seeker Name</th>
                                <th scope="col">Address</th>
                                <th scope="col">Status</th>
                                <th scope="col">Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.acceptedOrder == null)
                            {
                                foreach (var item in Model._orderList)
                                {
                                    var user = Model._mycontext.Users.Where(u => u.Id == item.SeekerId).SingleOrDefault();
                                    <tr>
                                        <th scope="row">@user.FirstName @user.LastName</th>
                                        <td>@user.Address</td>
                                        <td>
                                            <form method="post">
                                                <button asp-route-orderId="@item.Id" asp-page-handler="accept" class="btn btn-success">Accept</button>
                                                <button asp-route-orderId="@item.Id" asp-page-handler="decline" class="btn btn-danger">Decline</button>
                                            </form>
                                        </td>
                                        <td>Not available</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                var ordersAwaiting = Model._orderList.Count();
                                var userUndertaking = Model._mycontext.Users.Where(u => u.Id == Model.acceptedOrder.SeekerId).FirstOrDefault();
                                var phoneNo = userUndertaking.PhoneNo;
                                var uniqueCode = Model.acceptedOrder.UniqueCode.ToString();
                                <tr>
                                    <th scope="row">@userUndertaking.FirstName @userUndertaking.LastName</th>
                                    <td>@userUndertaking.Address</td>
                                    <td>Undertaking...</td>
                                    <td>
                                        <p>Phone Number: @phoneNo</p>
                                        <p>Unique code: @uniqueCode</p>
                                    </td>
                                </tr>
                                if (ordersAwaiting > 1)
                                {
                                    <tr>
                                        <td colspan="3">
                                            You have @ordersAwaiting other requests waiting. Finish the task at hand to accept another one
                                        </td>
                                    </tr>
                                }
                                else if (ordersAwaiting > 0)
                                {
                                    <tr>
                                        <td colspan="3">
                                            You have @ordersAwaiting other request waiting. Finish the task at hand to accept another one
                                        </td>
                                    </tr>
                                }

                            }
                        </tbody>
                    </table>


                }
                else
                {
                    <h1>You Have No Job Requests Currently!</h1>
                }





            </div>


        </div>

        <div class="tab-pane fade" id="pills-history" role="tabpanel" aria-labelledby="pills-history-tab">





        </div>
    </div>
</div>